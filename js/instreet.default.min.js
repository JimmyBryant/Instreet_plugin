(function(n,o){if(typeof n.InstreetWidget!="undefined"||n.InstreetWidget!=null){return null}else{n.InstreetWidget={version:"@REVISION@",name:"InstreetWidget"}}var q=n.document,navigator=n.navigator,location=n.location,imgs=[],outFlag,u=[],leftPad=-331,rightPad=28,prefix="http://push.instreet.cn/",config={cssurl:"http://static.instreet.cn/widgets/push/css/instreet_default.css",redurl:prefix+"click.action",callbackurl:prefix+"push.action",murl:prefix+"tracker.action",iurl:prefix+"tracker8.action",ourl:prefix+"loadImage.action",imih:290,imiw:290,position:'right'},ev={bind:function(a,b,c){if(a.addEventListener){a.addEventListener(b,c,false)}else if(a.attachEvent){a.attachEvent("on"+b,c)}else{a["on"+b]=c}},remove:function(a,b,c){if(a.removeEventListener){a.removeEventListener(b,c,false)}else if(a.datachEvent){a.datachEvent("on"+b,c)}else{a["on"+b]=null}},getEvent:function(a){return a?a:n.event},getTarget:function(a){return a.target||a.srcElement},stopPropagation:function(a){if(a.stopPropagation){a.stopPropagation()}else{a.cancelBubble=true}},getRelatedTarget:function(a){if(a.relatedTarget){return a.relatedTarget}else if(a.type=="mouseover"){return a.fromElement}else if(a.type=="mouseout"){return a.toElement}else{return null}},getXY:function(a){var x=0,y=0;if(a.getBoundingClientRect){var b=a.getBoundingClientRect();var D=q.documentElement;x=b.left+Math.max(D.scrollLeft,q.body.scrollLeft)-D.clientLeft;y=b.top+Math.max(D.scrollTop,q.body.scrollTop)-D.clientTop}else{for(;a!=q.body;x+=a.offsetLeft,y+=a.offsetTop,a=a.offsetParent){}};return{x:x,y:y}},aTrim:function(c){var d=new Array();c.sort(sortNum);var e=c.length,flag=0;for(var i=0;i<e;i++){if(c[i]!=c[i+1]){d[flag]=c[i];flag++}}return d;function sortNum(a,b){return a-b}},$:function(a,b,c){var d=a||q;if(q.getElementsByClassName)return d.getElementsByClassName(c);var e=[];var f=b||'*';f=f.toUpperCase();var g=d.getElementsByTagName(f);for(var l=g.length,i=l;i--;){var h=g[i];if(h.className){var k=h.className.replace(/\s/g,'|').split('|');for(var m=k.length,j=m;j--;){if(k[j]==c){e.push(h);break}}}}return e},importFile:function(a,b){var c;switch(a){case"js":c=q.createElement('script');c.src=b;c.charset="utf-8";c.type="text/javascript";break;case"css":c=q.createElement("link");c.type="text/css";c.rel="stylesheet";c.href=b;break}var d=q.getElementsByTagName('head')[0];d.appendChild(c)},findByAttr:function(a,b,c){var d=[];if(a){for(var i=0,len=a.length;i<len;i++){var e=a[i];if(e.getAttribute(b)==c.toString()){d.push(e)}}}return d},show:function(a){a.style.display='block'},hide:function(a){a.style.display='none'},hasClass:function(a,c){if(a&&a.className){var b=new RegExp(c);return b.test(a.className)}return false}},$=function(a){return q.getElementById(a)};var u=[],run=function(){for(var i=0;i<u.length;i++)u[i]&&u[i]()},doScrollCheck=function(){try{q.documentElement.doScroll('left')}catch(err){setTimeout(doScrollCheck,1);return}run()};q.ready=function(a){var b=!!n.ActiveXObject;if(q.readyState==="complete"){u.push(a);run();return}if(u.push(a)>1)return;if(q.addEventListener)return q.addEventListener('DOMContentLoaded',run,false);if(b){doScrollCheck()}};var z=function(a){var b=a.img,src=a.src,w=400,h=300,createMedia=function(){var e=q.createElement("embed");e.type="application/x-shockwave-flash";e.quality="high";return e},createContainer=function(){var e=q.createElement("div");e.className="instreet_video_wrap";return e};this.container=createContainer();this.video=createMedia();this.video.width=w;this.video.height=h;this.height=h;this.img=b;this.video.src=src};z.prototype={watch:function(){var a=this,container=$('INSTREET_CONTAINER'),wrap=this.container,str,pos=ev.getXY(a.img),w=a.img.width,padTop=Math.round(a.img.height-a.height)/2<0?0:Math.round(a.img.height-a.height)/2,h=a.img.height-padTop;wrap.style.cssText="position:absolute;text-align: center;padding-top:"+padTop+"px;top:"+pos.y+"px;left:"+pos.x+"px;background:#FFF;z-index:100010;opacity:.5;filter:alpha(opacity=50);width:"+w+"px;height:"+h+"px;";var b=q.createElement("a");b.href="javascript:;";b.style.cssText="display:inline-block;text-decoration:none;background:#000;font-size:14px;font-weight:bold;width:25px;height:25px;vertical-align:top;line-height:27px;color:#FFF;";b.title="关闭视频";b.innerHTML="×";b.onclick=function(){var c=this.parentNode,p=c.parentNode||q.body;p.removeChild(c)};wrap.appendChild(a.video);wrap.appendChild(b);container.appendChild(wrap)},close:function(){var a=this.container.parentNode||q.body;a.removeChild(this.container)}};var A=(function(){var f=[],intervalId=null,tick=function(){var i=0;for(;i<f.length;i++){f[i].end?f.splice(i--,1):f[i]()};!f.length&&stop()},stop=function(){clearInterval(intervalId);intervalId=null};return function(a,b,c,d){var e,width,height,newWidth,newHeight;if(a.complete){b.call(a);c&&c.call(a);return};width=a.width;height=a.height;a.onerror=function(){d&&d.call(a);e.end=true;a=a.onload=a.onerror=null};e=function(){newWidth=a.width;newHeight=a.height;if(newWidth!==width||newHeight!==height||newWidth*newHeight>1024){b.call(a);e.end=true}};e();a.onload=function(){!e.end&&e();c&&c.call(a);a=a.onload=a.onerror=null};if(!e.end){f.push(e);if(intervalId===null)intervalId=setInterval(tick,40)}}})();var B=null,slideDown=function(a,b){a.style.display="block";b=b||500;var c=a.offsetHeight,startTime=new Date().getTime();a.style.marginTop=c+'px';loop=function(){var p=(new Date().getTime()-startTime)/b,swing=((Math.cos(p*Math.PI)/2)+0.5);a.style.marginTop=Math.floor(c*swing)+'px';if(p<=1){clearTimeout(B);B=setTimeout(loop,10)}};loop()};var C={dataArray:[],avaImages:[],initData:function(){for(var i=0,len=imgs.length;i<len;i++){var a=i,img=new Image();img.src=imgs[a].src;img.setAttribute('instreet_img_id',a);A(img,this.ready,this.loadData)}},ready:function(){if(this.width<config.imiw||this.height<config.imih){this.onload=this.onerror=null}},loadData:function(){var a=this.getAttribute('instreet_img_id'),clientImg=imgs[a];if(clientImg){if(clientImg.width>=config.imiw&&clientImg.height>=config.imih){C.createJsonp(a);instreet.recordImage(clientImg)}}},createJsonp:function(a){var b=encodeURIComponent(encodeURIComponent(imgs[a].src)),url=config.callbackurl+"?index="+a+"&pd="+config.widgetSid+"&iu="+b+"&callback=insjsonp";ev.importFile('js',url)}},instreet={init:function(){var a=config.cssurl;ev.importFile('css',a);this.getImgs();this.createHolder();this.bindEvents()},dataReady:function(d){var c=$('INSTREET_CONTAINER'),icon_holder=this.createIcons(d),iconW=ev.$(c,'div','icon_wrapper')[0],fw=ev.$(c,null,'foot_wrapper')[0],share_icons=ev.$(icon_holder,null,'instreet_share_icons')[0];iconW&&iconW.appendChild(icon_holder);instreet.createSpots(d);var f=instreet.createFootAd(d);if(f){fw.appendChild(f)}icon_holder.onmouseover=function(){var a=ev.$(this,null,'tool_bar')[0];a&&(a.style.display='block')};icon_holder.onmouseout=function(a){var b=ev.$(this,null,'tool_bar')[0];b&&(b.style.display='none');var c=ev.getEvent(a),rel=ev.getRelatedTarget(c),index=this.getAttribute('instreet_img_id');if(rel&&rel.tagName=='IMG'&&rel.getAttribute('instreet_img_id')==index){return}else{if(f&&!f.getAttribute("width")){ev.hide(f.firstChild)}}};share_icons.onmouseover=function(){this.previousSibling.className+=' hover';ev.show(this)};share_icons.onmouseout=function(){this.previousSibling.className='icon_share';ev.hide(this)};if(f){f.onmouseover=function(e){ev.show(this.firstChild);c.setAttribute('instreet_img_id',this.getAttribute('instreet_img_id'));var a=ev.getEvent(e),rela=ev.getRelatedTarget(a),tar=ev.getTarget(a);if(!this.contains(rela)){instreet.recordAction(this)}};f.onmouseout=function(a){var b=ev.getEvent(a),rel=ev.getRelatedTarget(b),index=this.getAttribute('instreet_img_id');if(!this.getAttribute("width")){if(rel&&rel.tagName=='IMG'&&rel.getAttribute('instreet_img_id')==index){return}else{ev.hide(this.firstChild)}}instreet.hideAll(index)}}},getImgs:function(){var a=q.getElementsByTagName('img'),img;for(var i=0,len=a.length;i<len;i++){img=a[i];img.setAttribute('instreet_img_id',i.toString());imgs[i]=img}},recordImage:function(a){var b=encodeURIComponent(encodeURIComponent(a.src)),pd=config.widgetSid,pu=encodeURIComponent(encodeURIComponent(location.href)),t=encodeURIComponent(encodeURIComponent(q.title)),ul=config.ourl;ul+="?iu="+b+"&pd="+pd+"&pu="+pu+"&t="+t;ev.importFile('js',ul)},recordImgAction:function(a){var b=C.dataArray[a],img=imgs[a],ul=config.iurl,pd=b.widgetSid,muh=b.imageUrlHash,iu=encodeURIComponent(encodeURIComponent(img.src));ul+="?pd="+pd+"&muh="+muh+"&iu="+iu;ev.importFile('js',ul)},recordAction:function(a){var b=a.parentNode.parentNode.parentNode.parentNode.getAttribute('instreet_img_id')||a.parentNode.parentNode.getAttribute('instreet_img_id');if(b!=o){var c=C.dataArray[b],img=imgs[b],iu=encodeURIComponent(encodeURIComponent(img.src)),pd=c.widgetSid,ul=config.murl,mid=c.imageNumId||'',muh=c.imageUrlHash,ad='',at='',ift=0,tty=1;if(a.className.match("weibo_holder")){ift=2}else if(a.className.match("wiki_holder")){ift=4}else if(a.className.match("foot_holder")){ad=c.badsSpot[0].adsId;at=c.badsSpot[0].adsType}else if(a.id="instreet_ads_focus"){ad=a.getAttribute("adsid");at=1;tty=0}ul+="?iu="+iu+"&pd="+pd+"&muh="+muh+"&ad="+ad+"&mid="+mid+"&at="+at+"&tty="+tty+"&tg=&ift="+ift;ev.importFile('js',ul)}},createHolder:function(){var a=q.createElement("div"),adBox="<div class='ads_wrapper'><div class='ads_holder'></div><div class='weibo_holder'></div><div class='wiki_holder'></div></div>",spotBox="<div class='spot_wrapper'></div>",footBox="<div class='foot_wrapper'></div>",iconBox="<div class='icon_wrapper'></div>";a.id="INSTREET_CONTAINER";q.body.appendChild(a);a.innerHTML=adBox+footBox+spotBox+iconBox},createIcons:function(a){if(a){var b=parseInt(a.index),img=imgs[b],pos=ev.getXY(img),width=img.width,height=img.height,str='',pad=30,top=pos.y+height-pad,left,icon=q.createElement("div");left=config.position==='right'?pos.x+width-pad:pos.x+2;icon.className="instreet_icons_holder";icon.setAttribute('instreet_img_id',b);icon.style.cssText="left:"+left+"px;top:"+top+"px;";str="<a title='尚街网' instreet_img_id='"+b+"' class='icon_logo' href='javascript:;'></a><dl class='tool_bar'><dd><a href='http://www.imeiding.com' target='_blank' class='icon_setting'></a></dd><dd><a title='分享' href='javascript:;' class='icon_share'></a><div instreet_img_id='"+b+"' class='instreet_share_icons "+config.position+"'>";str+="<a class='instreet_sina'href='javascript:;'title='分享到新浪微博'></a><a title='分享到人人网' href='javascript:;' class='instreet_renren'></a><a href='javascript:;' title='分享到腾讯微博' class='instreet_tx'></a></div></dd><dd><a instreet_img_id='"+b+"' title='尚街网' href='javascript:;' class='icon_logo_hover'></a></dd></dl>";icon.innerHTML=str;return icon}},createSpots:function(a){if(a){var b=$('#INSTREET_CONTAINER'),spotW=ev.$(b,null,'spot_wrapper')[0],index=parseInt(a.index),adArr=[],i,len,w,spot;if(config.showAd){for(i=0,len=a.adsSpot.length;i<len;i++){var c=a.adsSpot[i];adArr.push(parseInt(c.metrix))}adArr=ev.aTrim(adArr);for(i=0,len=adArr.length;i<len;i++){w=a.adsSpot[0].width;spot=this.createSpot({metrix:adArr[i],width:w,adsType:true},index);spotW.appendChild(spot)}}if(config.showWeibo){for(i=0,len=a.weiboSpot.length;i<len;i++){spot=this.createSpot(a.weiboSpot[i],index);spotW.appendChild(spot)}}if(config.showWiki){for(i=0,len=a.wikiSpot.length;i<len;i++){spot=this.createSpot(a.wikiSpot[i],index);spotW.appendChild(spot)}}}},createSpot:function(a,b){if(a){var c=this.getPosition(a,b),top=c.top,left=c.left,r=11.5;var d=q.createElement('a');if(a.adsType)d.className="instreet_spot_ads";else if(a.type==1||a.type==2)d.className="instreet_spot_weibo";else if(a.type==4)d.className="instreet_spot_wiki";d.href="javascript:;";d.setAttribute('metrix',a.metrix);d.setAttribute('instreet_img_id',b);d.setAttribute('width',a.width);d.style.cssText="top:"+(top-r)+"px;left:"+(left-r)+"px;";return d}},createHolderContent:function(a){var b=q.createElement("div"),index=a.getAttribute('instreet_img_id'),img=imgs[index],data=C.dataArray[index],str='',metrix=a.getAttribute('metrix');str+="<h2 class='cont_head'><a class='button_close_holder' href='javascript:;' title='关闭'></a></h2>";switch(a.className){case"instreet_spot_ads":var c=0,f='';for(var i=0,len=data.adsSpot.length;i<len;i++){var d=data.adsSpot[i],redUrl=config.redurl+"?tty=0&mid="+d.imageNumId+"&muh="+data.imageUrlHash+"&pd="+d.widgetSid+"&ift=&tg=&at="+d.adsType+"&ad="+d.adsId+"&rurl="+encodeURIComponent(encodeURIComponent(d.adsLinkUrl));if(d.metrix==metrix){f=c?'':'instreet_ads_focus';if(c){str+="<a class='instreet_slider_left' href='javascript:;' title='上一个商品'></a><a title='下一个商品' class='instreet_slider_right' href='javascript:;'></a>"}str+="<div class='cont_body' id='"+f+"' adsid='"+d.adsId+"' index='"+c+"'><div class='left'><a class='thumb' target='_blank' href='"+redUrl+"' title='"+d.adsTitle+"'><img src='"+d.adsPicUrl+"'/></a></div><div class='right'><p class='p_desc'><a target='_blank' href='"+redUrl+"'>"+d.adsTitle+"</a></p>";if(d.adsDiscount){str+="<p class='p_money'>原价：<strong>"+d.adsPrice+"</strong></p><p class='p_nowmoney'>现价：<strong>"+d.adsDiscount+"</strong></p>"}else{str+="<p class='p_money'>价格：<strong>"+d.adsPrice+"</strong></p>"}str+="<p class='p_buyit'><a class='button_buy' href='"+redUrl+"' target='_blank'></a></p></div><div class='clear'></div></div>";c++}}break;case"instreet_spot_weibo":for(var i=0,len=data.weiboSpot.length;i<len;i++){var e=data.weiboSpot[i],title=e.title,nickName=e.nickName,icon=e.icon,avatar=e.avatar,latestStatus=e.latestStatus,redUrl=config.redurl+"?tty=1&mid="+data.imageNumId+"&muh="+data.imageUrlHash+"&pd="+data.widgetSid+"&ift="+e.type+"&at=&ad=&tg="+encodeURIComponent(encodeURIComponent(title))+"&rurl="+encodeURIComponent(encodeURIComponent(e.userUrl));if(e.metrix==metrix){str+="<div class='cont_body'><div class='left'><a class='thumb' target='_blank' href='"+redUrl+"' title='"+nickName+"'><img src='"+avatar+"'/></a></div><div class='right'><p class='summary'><a class='nickname' target='_blank' href='"+redUrl+"'>"+nickName+"</a>："+latestStatus+"</p><p class='icon'><a target='_blank' href='"+redUrl+"' title='微博'><img src='"+icon+"'/></a></p></div><div class='clear'></div></div>"}}break;case"instreet_spot_wiki":for(var i=0,len=data.wikiSpot.length;i<len;i++){var e=data.wikiSpot[i],title=e.title,firstimg=e.firstimg,summary=e.summary,redUrl=config.redurl+"?tty=1&mid="+data.imageNumId+"&muh="+data.imageUrlHash+"&pd="+data.widgetSid+"&ift="+e.type+"&at=&ad=&tg="+encodeURIComponent(encodeURIComponent(title))+"&rurl="+encodeURIComponent(encodeURIComponent(e.url));if(e.metrix==metrix){str+="<div class='cont_body'><div class='left'><a class='thumb' target='_blank' href='"+redUrl+"' title='"+title+"'><img src='"+firstimg+"'/></a></div><div class='right'><p><a class='nickname' target='_blank' href='"+redUrl+"'>"+title+"</a></p><p class='summary'>"+summary+"</p><p class='icon'><a target='_blank' href='"+redUrl+"' title='互动百科'><img src='http://static.instreet.cn/widgets/push/images/icon_baike.png'/></a></p></div><div class='clear'></div></div>"}}break}b.innerHTML=str;return b},createFootAd:function(a){var b=a.index,img=imgs[b],pos=ev.getXY(img),height=img.height,width=img.width,h=100,w=300,c=$('INSTREET_CONTAINER'),str='';if(a.badsSpot.length>0&&config.showFootAd){var d=a.badsSpot[0],foot=q.createElement('div');foot.className='foot_holder';foot.setAttribute('instreet_img_id',b);foot.style.cssText="top:"+(pos.y+height-h)+'px;left:'+(pos.x+(width-w)/2)+'px';str="<div class='foot_cont'><a class='button_close_foot'title='关闭' href='javascript:;'></a>";if(d.adsType){var e=config.redurl+"?tty=0&mid="+(a.imageNumId||0)+"&muh="+a.imageUrlHash+"&pd="+a.widgetSid+"&ift=&at="+(d.adsType||'')+"&ad="+(d.adsId||'')+"&tg=&rurl="+encodeURIComponent(encodeURIComponent(d.adsLinkUrl||''));if(d.adsType=='3'){str+="<a href='"+e+"' target='_blank'><img src='"+d.adsPicUrl+"' alt=''/></a>"}else if(d.adsType=='8'){str+="<img src='"+d.adsPicUrl+"' instreet_img_id='"+b+"' media_src='"+d.description+"' class='instreet_video_trigger' alt='' style='cursor:pointer;'/>"}else if(d.adsType=='9'){str+="<a href='"+e+"' target='_blank'><embed wmode='transparent' width='300' height='100'  src='"+d.adsPicUrl+"' type='application/x-shockwave-flash'></embed></a>"}else if(d.adsType=='2'){h=35;w=width-32;var f=d.adsPicUrl.split(','),pt=30;foot.setAttribute("width",w);foot.setAttribute("height",h+pt);foot.style.cssText="width:"+w+"px;height:"+h+"px;left:"+pos.x+"px;top:"+(pos.y+height-h-pt)+"px;padding-top:30px;";if(w>375){str+="<a href='"+e+"' class='black_bg' target='_blank'><img class='sprite1' src='"+(f[0]||"")+"' alt=''/><span class='slogan'><p class='light'>"+d.adsTitle+"</p><p>更多精彩»</p></span></a>"}else{str+="<a href='"+e+"' class='black_bg' target='_blank'><span class='slogan'><p class='light'>"+d.adsTitle+"</p><p>更多精彩»</p></span></a>"}}}else if(!d.adsLinkUrl&&d.description){var g=d.description;str+=g.slice(0,-2)+'></iframe>'}str+="</div>";if(!config.openFootAd){foot.style.display="none"}foot.innerHTML=str;return foot}return null},getPosition:function(a,b){var c=imgs[b],metrix=a.metrix,ox=metrix%3000,oy=Math.round(metrix/3000),w=a.width,zoomNum=c.width/w,x=ox*zoomNum,y=oy*zoomNum,pos=ev.getXY(c);return{top:(y+pos.y),left:(x+pos.x)}},eventDelegate:function(a){var b=ev.getEvent(a),target=ev.getTarget(b),type=b.type,c=target.className;if(target.tagName==='IMG'&&target.getAttribute('instreet_data_ready')){instreet.imgEvent(b)}else if(c=='instreet_spot_ads'||c=='instreet_spot_weibo'||c=='instreet_spot_wiki'){instreet.spotEvent(b)}else if(c=='instreet_slider_left'||c=='instreet_slider_right'||c=='button_close_holder'||c=='button_close_foot'||c=='instreet_video_trigger'){instreet.otherEvent(b)}instreet.iconEvent(b)},otherEvent:function(d){var e=ev.getTarget(d),type=d.type,container=$('INSTREET_CONTAINER'),c=e.className;if(type==='click'){if(c=='button_close_holder'){ev.hide(e.parentNode.parentNode.parentNode)}else if(c=='button_close_foot'){var f=e.parentNode.parentNode;ev.hide(f);f.className='foot_holder_noshow'}else if(c=='instreet_video_trigger'){var g=e.getAttribute('instreet_img_id'),img=imgs[g],src=e.getAttribute('media_src'),v=new z({img:img,src:src});v.watch()}else{var h=ev.$(e.parentNode,null,'cont_body '),length=h.length,focus=$('instreet_ads_focus'),g=parseInt(focus.getAttribute('index')),next;function go(a){var b;ev.hide(focus);focus.id='';b=ev.findByAttr(h,'index',a)[0];ev.show(b);b.id='instreet_ads_focus'};if(c=="instreet_slider_left"){if(g>0)next=g-1;else next=length-1;go(next)}else{if(g<(length-1))next=g+1;else next=0;go(next)}}}},spotEvent:function(e){var f=ev.getTarget(e),type=e.type,container=$('INSTREET_CONTAINER'),c=f.className,index=f.getAttribute('instreet_img_id'),spotOver=function(s,h){var a=ev.getXY(s),r=24;if(s.id=='instreet_spot_focus'){h.style.cssText="top:"+(a.y+r)+"px;left:"+(a.x+r)+"px";ev.show(h)}else{var c=$('instreet_spot_focus');if(c){var d=b=/(\w+)_(\w+)_(\w+)/g,result=d.exec(c.className),fName=result[3]+'_holder',fh=ev.$(container,null,fName)[0];c.id='';ev.hide(fh)}s.id='instreet_spot_focus';h.style.cssText="top:"+(a.y+r)+"px;left:"+(a.x+r)+"px";cont=instreet.createHolderContent(s),h.innerHTML='';h.appendChild(cont)}};if(type==='mouseover'){switch(c){case"instreet_spot_ads":var g=ev.$(container,null,'ads_holder')[0];spotOver(f,g);break;case"instreet_spot_weibo":var i=ev.$(container,null,'weibo_holder')[0];spotOver(f,i);break;case"instreet_spot_wiki":var j=ev.$(container,null,'wiki_holder')[0];spotOver(f,j);break}}},iconEvent:function(a){var b=ev.getTarget(a),type=a.type,container=$('INSTREET_CONTAINER'),c=b.className;if(type==='click'){if(c==='icon_logo'){b.nextSibling.className='tool_bar';b.nextSibling.style.display='block';var d=b.getAttribute('instreet_img_id'),spots=instreet.findSpotsByImg(d);if(spots){for(var i=0,len=spots.length;i<len;i++){ev.show(spots[i])}}imgs[d].setAttribute('showAd',true)}else if(c==='icon_logo_hover'){var e=b.parentNode.parentNode,d=b.getAttribute('instreet_img_id'),spots=instreet.findSpotsByImg(d);instreet.hideAll(d);e.className='tool_bar_hidden';imgs[d].setAttribute('showAd',false)}else if(c=='instreet_sina'||c=='instreet_renren'||c=='instreet_tx'){var d=parseInt(b.parentNode.getAttribute('instreet_img_id')),picUrl=imgs[d].src;switch(c){case"instreet_sina":n.open('http://v.t.sina.com.cn/share/share.php?title='+encodeURIComponent(q.title)+'&url='+encodeURIComponent(q.URL)+'&pic='+encodeURIComponent(picUrl),"_blank","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=580, height=500");break;case"instreet_renren":n.open('http://share.renren.com/share/buttonshare.do?link='+encodeURIComponent(q.URL),"_blank","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=570, height=326");break;case"instreet_tx":n.open('http://share.v.t.qq.com/index.php?c=share&a=index&title='+encodeURI(q.title+'\n\n')+'&url='+encodeURI(q.URL)+'&pic='+encodeURIComponent(picUrl),"_blank","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=580, height=500");break}}}else if(type==='mouseover'){if(c==='icon_share'){c+=' hover';b.nextSibling.style.display="block"}}else if(type==='mouseout'){if(ev.hasClass(b,'icon_share')){c='icon_share';ev.hide(b.nextSibling)}}},imgEvent:function(a){var b=ev.getTarget(a),type=a.type,container=$('INSTREET_CONTAINER'),index=b.getAttribute('instreet_img_id'),toolbar=instreet.findToolByImg(index),spots=instreet.findSpotsByImg(index),foot=instreet.findFootByImg(index);if(imgs[index].getAttribute('showAd')!="false"){if(type==='mouseover'){if(spots){for(var i=0,len=spots.length;i<len;i++){ev.show(spots[i])}}if(foot&&foot.style.display=='none'){ev.show(foot);slideDown(foot.firstChild)}container.setAttribute('instreet_img_id',index);if(toolbar){if(toolbar.style.display!="block"){instreet.recordImgAction(index);toolbar.style.display='block'}toolbar.parentNode.style.zIndex="111111"}}else if(type==='mouseout'){instreet.hideAll(index)}}},hideAll:function(a){var c=$('INSTREET_CONTAINER'),toolbar=instreet.findToolByImg(a),spotW=ev.$(c,null,'spot_wrapper')[0],spots=spotW.getElementsByTagName('a'),foot=instreet.findFootByImg(a);var d=$('instreet_spot_focus');if(foot&&!foot.getAttribute("width")){ev.hide(foot);ev.hide(foot.firstChild)}if(d){var e=b=/(\w+)_(\w+)_(\w+)/g,result=e.exec(d.className),fName=result[3]+'_holder',fh=ev.$(c,null,fName)[0];ev.hide(fh)}if(spots){for(var i=0,len=spots.length;i<len;i++){ev.hide(spots[i])}}if(toolbar){toolbar.style.display='none';toolbar.parentNode.style.zIndex="99999"}},holderEvent:function(a,b){var c=ev.getEvent(a),rel=ev.getRelatedTarget(c),spot_focus=$('instreet_spot_focus'),index=spot_focus.getAttribute('instreet_img_id');if(rel&&rel.tagName=='IMG'&&rel.getAttribute('instreet_img_id')==index){return}else{instreet.hideAll(index)}},findSpotsByImg:function(a){var b=$('INSTREET_CONTAINER'),spotW=ev.$(b,null,'spot_wrapper')[0],spotsAll=spotW.getElementsByTagName('a'),spots=ev.findByAttr(spotsAll,'instreet_img_id',a);return spots},findToolByImg:function(a){var b=$('INSTREET_CONTAINER'),aw=ev.$(b,null,'instreet_icons_holder'),w=ev.findByAttr(aw,'instreet_img_id',a)[0],toolbar=ev.$(w,null,'tool_bar')[0];return toolbar},findFootByImg:function(a){var b=$('INSTREET_CONTAINER'),fw=ev.$(b,null,'foot_holder'),foot=ev.findByAttr(fw,'instreet_img_id',a)[0];return foot},checkPosition:function(){var c=$("INSTREET_CONTAINER"),iconHs=ev.$(c,null,'instreet_icons_holder'),index,i,len,spotsW=ev.$(c,null,'spot_wrapper')[0],spots=spotsW.getElementsByTagName('A'),pos,footHs=ev.$(c,null,'foot_holder');for(i=0,len=iconHs.length;i<len;i++){var h=iconHs[i],img,pad=30,left,top;index=h.getAttribute('instreet_img_id');img=imgs[index];pos=ev.getXY(img);top=pos.y+img.height-pad;left=config.position==='right'?pos.x+img.width-pad:pos.x+2;h.style.cssText="top:"+top+"px;left:"+left+"px;"}for(i=0,len=spots.length;i<len;i++){var s=spots[i],metrix=s.getAttribute('metrix'),width=s.getAttribute('width'),r=2;index=s.getAttribute('instreet_img_id');pos=instreet.getPosition({metrix:metrix,width:width},index);s.style.cssText="top:"+(pos.top-r)+"px;left:"+(pos.left-r)+"px;"}for(i=0,len=footHs.length;i<len;i++){var a=footHs[i],index=a.getAttribute('instreet_img_id'),img=imgs[index],pos=ev.getXY(img),width=img.width,height=img.height,w=parseInt(a.getAttribute('width'))||300,h=parseInt(a.getAttribute('height'))||100;a.style.top=(pos.y+height-h)+"px";if(a.getAttribute('width'))a.style.left=pos.x+"px";else a.style.left=(pos.x+(width-w)/2)+"px"}},bindEvents:function(){var c=$('INSTREET_CONTAINER'),ads=ev.$(c,null,'ads_holder')[0],weibo=ev.$(c,null,'weibo_holder')[0],wiki=ev.$(c,null,'wiki_holder')[0];ev.bind(q.body,'mouseover',instreet.eventDelegate);ev.bind(q.body,'mouseout',instreet.eventDelegate);ev.bind(q.body,'click',instreet.eventDelegate);ev.bind(n,'load',function(){instreet.checkPosition();ev.bind(n,'resize',instreet.checkPosition)});c.onmouseover=function(a){var b=this.getAttribute('instreet_img_id'),spots,toolbar,foot;if(b!=o){if(imgs[b].getAttribute('showAd')!='false'){spots=instreet.findSpotsByImg(b);toolbar=instreet.findToolByImg(b);foot=instreet.findFootByImg(b);if(spots){for(var i=0,len=spots.length;i<len;i++){ev.show(spots[i])}}if(foot){ev.show(foot);ev.show(foot.firstChild)}toolbar&&ev.show(toolbar)}}};ads.onmouseover=function(e){ev.show(this);var a=ev.getEvent(e),rela=ev.getRelatedTarget(a),foc=$('instreet_ads_focus'),tar=ev.getTarget(a);if(!foc.contains(rela)&&foc.contains(tar)){instreet.recordAction(foc)}};ads.onmouseout=function(a){instreet.holderEvent(a,this)};weibo.onmouseover=function(e){ev.show(this);var a=ev.getEvent(e),rela=ev.getRelatedTarget(a);if(!this.contains(rela)){instreet.recordAction(this)}};weibo.onmouseout=function(a){instreet.holderEvent(a,this)};wiki.onmouseover=function(e){ev.show(this);ev.show(this);var a=ev.getEvent(e),rela=ev.getRelatedTarget(a);if(!this.contains(rela)){instreet.recordAction(this)}};wiki.onmouseout=function(a){instreet.holderEvent(a,this)}}};n['insjsonp']=function(a){if(a){var b=a.index,img=imgs[b];C.dataArray[b]=a;C.avaImages.push(img);img.setAttribute('instreet_data_ready',true);instreet.dataReady(a)}};var E=function(c){if(c&&typeof c=="object"){for(var i in c){config[i]=c[i]}}else{return}};E(instreet_config);var F=function(){instreet.init();C.initData()};q.ready(function(){F()})})(window);